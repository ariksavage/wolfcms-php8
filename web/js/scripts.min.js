//alert(window.innerWidth+" x "+window.innerHeight);
window.onload = function(){
	if (window.innerWidth >= 680){ 
		navAlign();
	}
	if (document.body.className.indexOf('home')>-1){
		slideShow('slideshow',0,5000);
	}
	if (document.body.className.indexOf('project')>-1){
		loadProject();
	}
	if (document.body.className.indexOf('portfolio')>-1){
		loadPortfolio();
	}
};
window.addEventListener('resize', function(){
navAlign();
});

var paused = false;
function pause(){
	paused = !paused;
	console.log("paused is "+paused);
	if (!paused){slideShow('slideshow',i-1,5000);}
}
function navAlign(){
	var nav = document.getElementById('main').getElementsByTagName('ul')[0];
	var items = nav.children;
	var a = nav.clientWidth;
	var y = Math.floor(nav.clientWidth/items.length);
	for (var i=0;i<items.length;i++){
		var f = items[i].style.fontSize = Math.floor(nav.offsetHeight * .6)+"px";
		var x = items[i].clientWidth;
		var b = Math.floor((y-x)/2);
		b = ((b/a)*100);
		items[i].style.margin = "0 "+b + "%";
		if (i+1 == items.length){
			var Left = items[i].offsetLeft;
		}
	}
	document.getElementById('secondary').style.left = Left + 39 +"px";
	document.getElementById('secondary').style.fontSize = f;
}
var i;
function slideShow(id, start, interval){
	if (!paused){
		i = start
		var slideshow = document.getElementById(id);
		if (typeof(slideshow) !== 'undefined' && slideshow !== null && slideshow !== ''){
			var slides=slideshow.getElementsByTagName('img');
			for (var s=0;s<slides.length;s++){
				slides[s].style.display='none';
			}
			slides[i].style.display='block';
			if(i< slides.length - 1) {
				i++;
			} else {
				i = 0;
			}
	}
	setTimeout("slideShow('"+id+"',"+i+", "+interval+")", interval); 
	}
}
function portfolio(id, single){

	var port = document.getElementById(id);

	if (typeof(port) !== 'undefined' && port !== null && port !== ''){
		var wholeWidth = port.offsetWidth;
		var albums = port.getElementsByClassName('album');
		var p = 6;
		var albumSize = 0;
		while (albumSize < 200){
			p--;
			albumSize = Math.floor(wholeWidth / p);
			
		}

		if (single == true){
			var slides = document.getElementById('slideshow');
			var info = document.getElementById('info');
			//alert('width: '+window.innerWidth);
			if (p>2 && window.innerWidth > 680){
				info.style.width = albumSize-20 + "px";
				info.style.padding = "0 5px";
				slides.style.width = ((p-1)*albumSize)-1+"px";
			}else{
				info.style.width = wholeWidth;
				slides.style.width = wholeWidth;
			}
			port.style.height= albumSize+"px";
		}
		
		for (var a=0;a<albums.length;a++){
			albums[a].style.width = albums[a].style.height = albumSize + "px";
			var preview = albums[a].getElementsByClassName('preview')[0];
			var x = preview.clientWidth;
			var y = preview.clientHeight;
			if (y > x){ // tall photo
				preview.style.width = albumSize+"px";
				preview.style.top = Math.floor((albumSize - preview.clientHeight) / 2)+"px";
			}else{ //wide photo
				preview.style.height = albumSize+"px";
				preview.style.left = Math.floor((albumSize - preview.clientWidth) / 2)+"px";
			}
		}
	}
}
function moveGallery(dir){
var gallery = document.getElementById('portfolio');
var albums = gallery.children;
switch (dir){
	case 'next':
		var clone = albums[0].cloneNode(true);
		gallery.appendChild(clone);
		albums[0].parentNode.removeChild(albums[0]);
	break;
	case 'prev':
		var clone = albums[albums.length-1].cloneNode(true);
		gallery.insertBefore(clone, albums[0]);
		albums[albums.length-1].parentNode.removeChild(albums[albums.length-1]);
	break;
	default:
	break;
}
}
//PROJECT SLIDESHOW FUNCTIONS
var projectSlide;

var loaded = false;
function pauseProjectSlide(){
	clearTimeout(projectSlide);
	return 'pause';
}
function gotoSlide(n, interval){
	paused = false;
	clearTimeout(projectSlide);
	projectSlideShow(n-1, interval); 
}
function clearListeners(el){
	elClone = el.cloneNode(true);
	el.parentNode.replaceChild(elClone, el);
}
function projectSlideShow(i, interval){

	if (!paused){
		var outer = document.getElementById('slideshow');
		var slideshow = document.getElementById('slide-track');
		var slides=slideshow.getElementsByTagName('img');
		var ind = document.getElementById('indicators');
		var prev= document.getElementById('leftArrow');
		var next= document.getElementById('rightArrow');
		var indys = ind.children;
		var hideshow = [slideshow, ind, prev, next];
		
		var p = (i == 0)? slides.length : i;
		prev.onclick=function(){gotoSlide(p, interval);};
		
		var b = (i< slides.length-1)? i+2: 1;
		next.onclick=function(){gotoSlide(b, interval);};
		outer.onmouseenter=function(){paused=true;};
		outer.onmouseleave=function(){paused=false;};
		//set right offset
		var r = 0;
		for (var s=0 ; s<i; s++){
			r += slides[s].offsetWidth + 7;
		}
		slideshow.style.right = r+"px";
		
		//set active indicator
		for (var a=0;a<indys.length;a++){
			if (a == i){
				addClass(indys[a],'active');
			}else{
				removeClass(indys[a],'active');
			}
			if (i<0){
				addClass(indys[0],'active');
			}
		}
		i = (i< slides.length-1) ? i+1: 0;
	}
	projectSlide = setTimeout("projectSlideShow("+i+", "+interval+")", interval); 
}
function showminiform(){
	var form = document.getElementById('miniform');
	if (form.className.indexOf('show')>-1){
		removeClass(form,'show');
	}else{
		addClass(form,'show');
	}
}
function loadProject(){
	portfolio('portfolio', true);
	setTimeout(function(){
		addClass(document.body,'load');
		projectSlideShow(0,3000);
	},1000);
}
function loadPortfolio(){
	portfolio('portfolio', false);
}
function toggleMobileNav(){
	var button = document.getElementById('mobile-nav');
	var header = document.getElementById('header');
	var nav = document.getElementById('main');
	if (nav.className.indexOf('mobile')>-1){
		removeClass(nav, 'mobile');
	}else{
		addClass(nav,'mobile');
	}
	var lis = nav.getElementsByTagName('li');
	for (var l=0; l<lis.length;l++){
		 if (lis[l].getElementsByTagName('ul').length>0){
			addClass(lis[l],'has-subnav');
			var sls = lis[l].getElementsByTagName('li');
			var sw = lis[l].clientWidth;
			for (var s=0;s<sls.length;s++){
				sls[s].style.width=(Math.floor(sw/2))+"px";
			}
			var clone = lis[l].cloneNode(true);
			lis[l].parentNode.appendChild(clone);
			lis[l].parentNode.removeChild(lis[l]);
		}
	}
}

function addClass(elem, cl){
	if (document.documentElement.className.indexOf('ie')>-1){
		elem.className = elem.className+' '+cl;
	}else{
		elem.classList.add(cl);
	}
}
function removeClass(elem, cl){
	if (document.documentElement.className.indexOf('ie')>-1){
		elem.className = elem.className.replace(' '+cl,'');
	}else{
		elem.classList.remove(cl);
	}
}
function showSub(el){
	var sub = el.parentNode.getElementsByTagName('ul')[0];
	console.log(sub.style.maxHeight);
	if (parseInt(sub.style.maxHeight) > 0){
		sub.style.maxHeight="0";
	}else{
		sub.style.maxHeight="500px";
	}
}
